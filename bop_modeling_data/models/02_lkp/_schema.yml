models:
  - name: lkp__associated_policies
    description: |-
      This lookup table provides mappings for each policy *associated with* a policy from our decicion file processing. Here "associated with" means "shares a `policy_chain_id` with".  

      The table:  
      1. Gives each associated policy a unique integer ID
    columns:
      - name: associated_policy_key
        data_type: bigint
        data_tests:
          - not_null
          - unique
      - name: associated_sb_policy_key
        data_type: bigint
        data_tests:
          - not_null
          - relationships:
              field: sb_policy_key
              to: ref('raw__decfile__sb_policy_lookup')
      - name: policy_chain_id
        data_type: uinteger
        data_tests:
          - not_null
          - relationships:
              field: policy_chain_id
              to: ref('raw__modcom__policy_chain_v3')
      - name: company_numb
        data_type: utinyint
        data_tests:
          - not_null
          - relationships:
              field: company_numb
              to: ref('raw__modcom__policy_chain_v3')
      - name: policy_sym
        data_type: varchar
      - name: policy_numb
        data_type: uinteger
        data_tests:
          - not_null
      - name: policy_module
        data_type: uinteger
      - name: policy_eff_date
        data_type: timestamp
      - name: is_gt1_five_key_in_table
        data_type: integer
      - name: __is_gt1_five_key_in_table
        data_type: utinyint
  - name: lkp__billing_policies
    description: This model connects account- and policy-level identifiers from CinciBill to those developed in the decision file data process. A common set of integer keys will be used for building datamart tables.
    columns:
      - name: associated_policy_key
        description: This uniquely identifies the policy that is associated with a SB policy by way of the policy chain.
        data_type: hugeint
        tests:
          - not_null
      - name: associated_sb_policy_key
        description: This describes the first SB policy key the row is associated to (in the case that multiple policies are themselves associated by way of the policy chain)
        data_type: uinteger
        tests:
          - not_null
      - name: billing_acct_key
        data_type: bigint
      - name: billing_policy_key
        data_type: hugeint
      - name: billing_policy_id
        data_type: varchar
      - name: billing_acct_id
        data_type: varchar
      - name: policy_sym
        data_type: varchar
      - name: policy_numb
        data_type: uinteger
      - name: policy_eff_date
        data_type: date
      - name: billing_sb_policy_key
        data_type: bigint
  - name: lkp__sb_policy_key
    description: Currently should be the same as `stg__decfile__sb_policy_key`, but will materialize a lookup table model for later performance.
    columns:
      - name: sb_policy_key
        data_type: bigint
        description: Unique identifier for the policy-lob combination used in the BOP Decision file data processing. Integer starting at 1 and is the sorted ordering of the five-key and policy_chain_id.
      - name: policy_chain_id
        data_type: bigint
      - name: lob
        data_type: varchar
        description: Line of business
        data_tests:
          - accepted_values:
              values:
                - prop
                - liab
          - not_null
      - name: company_numb
        data_type: bigint
        data_tests:
          - accepted_values:
              values:
                - 1
                - 3
                - 4
                - 5
                - 7
                - 9
          - not_null
        description: Company number
      - name: policy_sym
        data_type: varchar
        description: Policy symbol. This list is a bit more restrictive than the similar one for associated policies, since the SB decision file is built off the AIV's, which only use eClas data.
        data_tests:
          - not_null
          - accepted_values:
              values:
                - ETD
                - ECP
                - ELD
                - ENP
                - EPP
                - ETN
      - name: policy_numb
        data_type: bigint
        description: Policy number. Up to 7 digits.
        data_tests:
          - not_null
      - name: policy_module
        data_type: bigint
        data_tests:
          - not_null
      - name: policy_eff_date
        data_type: date
        description: |-
          Policy effective date
        data_tests:
          - not_null
  - name: lkp__billing_activity
    description: Lookup model setting an activity transaction key for future activity count feature engineering.
    columns:
      - name: activity_trans_key
        data_type: hugeint
      - name: associated_policy_key
        data_type: hugeint
      - name: associated_sb_policy_key
        data_type: uinteger
      - name: billing_activity_date
        data_type: date
      - name: billing_activity_amt
        data_type: double
  - name: lkp__first_billing_activity
    description: First billing activity date is analogous to report date in the world of claim counts.
    columns:
      - name: activity_trans_key
        description: Unique identifier for a billing activity transaction.
        data_type: hugeint
        data_tests:
          - not_null
          - unique
      - name: first_billing_activity_date
        description: Minimum of the billing activity date from the lkp__billing_activity model.
        data_type: date
        data_tests:
          - not_null
  - name: lkp__dates
    columns:
      - name: input_date
        data_type: date
      - name: n_prior_years
        data_type: integer
      - name: prior_year_start
        data_type: date
      - name: prior_year_end
        data_type: date
  - name: lkp__policy_chain_ids
    columns:
      - name: policy_chain_id
        data_type: bigint
      - name: n_sb_policies_for_policy_chain_id
        data_type: bigint
      - name: n_total_policies_for_policy_chain_id
        data_type: bigint
