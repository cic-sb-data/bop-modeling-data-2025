version: 2

models:
  - name: lkp__associated_policies
    description: |
      Lookup model that identifies all policies associated with each small business (SB) policy originating from the decfile process.
      It links each `sb_policy_key` (from `stg__decfile__sb_policy_lookup`) to every policy (company_numb, policy_sym, policy_numb, policy_module, policy_eff_date)
      found within the same `policy_chain_id` (from `stg__modcom__policy_chain_v3`).
      The `associated_policy_key` is generated for each policy in the chain using the `policy_key()` macro.
      The grain of this model is the combination of `associated_policy_key` and `associated_sb_policy_key`,
      meaning each record represents a unique link between a policy in a chain and an SB policy key that shares that chain.
      This model is crucial for understanding the full history and relationships of policies connected through a policy chain.
    columns:
      - name: associated_policy_key
        description: 'A unique key for each policy (company_numb, policy_sym, policy_numb, policy_module, policy_eff_date) found in a policy chain that is associated with an sb_policy_key. Generated by the `policy_key()` macro.'
        tests:
          - not_null
      - name: associated_sb_policy_key
        description: 'The `sb_policy_key` from the decfile process. This key identifies a specific small business policy term and line of business (e.g., property or liability). It is the anchor for finding all other associated policies in the chain.'
        tests:
          - not_null
      - name: policy_chain_id
        description: 'Identifier for the policy chain. Links the `associated_sb_policy_key` to all policies within its chain.'
        tests:
          - not_null
      - name: company_numb
        description: 'Component of the five-field policy key: Company number.'
        tests:
          - not_null
      - name: policy_sym
        description: 'Component of the five-field policy key: Policy symbol.'
        tests:
          - not_null
      - name: policy_numb
        description: 'Component of the five-field policy key: Policy number.'
        tests:
          - not_null
      - name: policy_module
        description: 'Component of the five-field policy key: Policy module.'
        tests:
          - not_null
      - name: policy_eff_date
        description: 'Component of the five-field policy key: Policy effective date.'
        tests:
          - not_null

  - name: lkp__billing_policies
    description: 'Lookup model for billing policies. It filters raw billing policies and adds a billing_sb_policy_key. It references `lkp__associated_policies`.'
    columns:
      - name: billing_sb_policy_key
        description: 'Key for billing small business policy.'
      # Add other relevant column descriptions.
      - name: placeholder_column
        description: 'This is a placeholder. Describe other relevant columns.'

  - name: lkp__dates
    description: 'Lookup model for dates, generating prior year columns.'
    columns:
      - name: input_date
        description: 'The base date for generating prior year dates.'
      # Add other relevant column descriptions for date components and prior year dates.
      - name: placeholder_column
        description: 'This is a placeholder. Describe other relevant columns.'

  - name: lkp__first_billing_activity_date
    description: 'Lookup model to determine the first billing activity date for a policy. It references `fct__billing_activity`.'
    columns:
      # Add relevant column descriptions.
      - name: placeholder_column
        description: 'This is a placeholder. Describe relevant columns.'

  - name: lkp__policy_chain_ids
    description: 'Lookup model for policy chain IDs, counting total policies associated with each chain.'
    columns:
      - name: policy_chain_id
        description: 'Identifier for the policy chain.'
      # Add other relevant column descriptions.
      - name: placeholder_column
        description: 'This is a placeholder. Describe other relevant columns.'

  - name: lkp__sb_policy_key
    description: 'Lookup model for small business policy keys.'
    columns:
      # Add relevant column descriptions.
      - name: placeholder_column
        description: 'This is a placeholder. Describe relevant columns.'
