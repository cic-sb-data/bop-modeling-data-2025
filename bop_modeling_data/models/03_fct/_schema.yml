version: 2

models:
  - name: fct__associated_policy_eff_date
    description: 'Fact model for associated policy effective dates. It references `lkp__associated_policies` and `lkp__dates`.'

  - name: fct__billing_activity
    description: 'Fact model for billing activity. It adds an activity_transaction_key and references `stg__cur_cb` and `lkp__dates`.'
    columns:
      - name: activity_transaction_key
        description: 'Key for billing activity transactions.'
      - name: activity_trans_key
        data_tests:
          - unique
          - not_null
      - name: associated_policy_key
        data_tests:
          - not_null
          - relationships:
              to: ref('lkp__associated_policies')
              field: associated_policy_key
      - name: associated_sb_policy_key
        data_tests:
          - not_null
          - relationships:
              to: ref('lkp__associated_policies')
              field: associated_sb_policy_key

  - name: fct__prior_activity_dates
    description: 'Fact model for prior activity dates, filtering out activity not knowable at policy effective date. It uses the `make_n_prior_year_cols` macro and references `fct__associated_policy_eff_date` and `fct__billing_activity`.'
